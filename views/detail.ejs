<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <%- include('nav.ejs') %>
  <section class="sec">
    <div class="white-bg">
      <div class="list-box">
        <p class="writer" style="margin-bottom: 20px;">ì‘ì„±ì : <%= result.userid %>
          <a href="/chat/request?writerId=<%= result._id %>">ì±„íŒ…í•˜ê¸°</a>
      <!-- wrtieId : ì‘ì„±ì id,
          result._id : í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì•„ì´ë””
      -->
      

          <% let checkLogin = loginUser == result.userid %>
          <% if(checkLogin) { %>
            <span class="btn">
              <a href="/edit/<%= result._id %>">âœï¸</a>
              <a href="/delete/<%= result._id %>" class="delete" data-id="<%= result._id %>">ğŸ—‘ï¸</a>
            </span>
          <% } %>
        </p>

        <h2 style="color: #000; font-size: 38px;" ><%= result.title %></h2>
        
        <p style="display: flex; justify-content: center;"><%= result.content  %></p>
      </div>

      <!-- parentId : ê²Œì‹œê¸€ë²ˆí˜¸ (postì»¬ë ‰ì…˜ì˜ _id)-->
      <div class="comment-write">
        <form action="/comment" method="POST">
          <label for="commentContent"><%= loginUser %> </label>
          <input name="content" id="commentContent">
          <input name="parentId" value="<%= result._id %>" type="hidden">
          <button>ëŒ“ê¸€ì‘ì„±</button>
        </form>
      </div>

      <!-- ëŒ“ê¸€ëª©ë¡ -->
      <div class="comment-list">
          <% for(let i = 0; i < comment.length; i++){ %>
            <p>
              <span><%= comment[i].writer %> </span>
              <span><%= comment[i].content %></span>
            </p>
          <% } %>
      </div>
    </div>
  </section>
  <script>
    const BASE_URL = 'http://localhost:3000';  
    const del = document.querySelector('.delete')
    del.addEventListener('click',async function(event){
      event.preventDefault();
      const isConfirmed = confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
    if (isConfirmed) {
    // ì‚¬ìš©ìê°€ í™•ì¸ì„ ëˆŒë €ì„ ê²½ìš°
    const postId = event.target.dataset.id; // ì‚­ì œí•  ê²Œì‹œê¸€ì˜ IDë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
      const response = await fetch(`${BASE_URL}/delete/${postId}`,{
        method : 'DELETE'
      })
      window.location.href ="/list"
      console.log(response)
    }
  })
  </script>
</body>
</html>